# Documentación de Cambios en Oracle 19c para Cambiar la Instancia y Crear un Usuario

## 1. **Cambio del nombre de la instancia en Oracle 19c**

### Paso 1: Modificar el nombre de la instancia en los archivos del sistema

Primero, realizamos los cambios necesarios en los archivos de configuración para cambiar el nombre de la instancia de **ORCLCDB** a **KK**.

#### Archivos modificados:
- **/etc/oratab**: Cambié el nombre de la instancia a **KK**.
- **~/.profile**: Establecí el nombre de la instancia para el entorno del usuario `oracle`.

```bash
# /etc/oratab
ORCLCDB:/opt/oracle/product/19c/dbhome_1:Y
# Cambié a:
KK:/opt/oracle/product/19c/dbhome_1:Y
```

```bash
# ~/.profile
export ORACLE_SID=KK
# Cambié a:
export ORACLE_SID=KK
```

#### Acción:

- Ejecuto el comando `source ~/.profile` para que los cambios tomen efecto inmediatamente.

### Paso 2: Verificar la variable `ORACLE_SID`

Verifiqué que la variable de entorno `ORACLE_SID` se haya actualizado correctamente a **KK**.

```bash
echo $ORACLE_SID
KK
```

---

## 2. **Problemas al intentar arrancar la base de datos**

### Intenté iniciar la base de datos con el nuevo nombre de la instancia:

```bash
sqlplus / as sysdba
STARTUP NOMOUNT;
```

#### Error:

```bash
ORA-01034: ORACLE not available
ORA-27101: shared memory realm does not exist
```

Este error ocurrió porque la instancia no estaba disponible debido a la falta de un archivo de inicialización para **KK**.

### Paso 3: Solución al error de la instancia

#### Creación de un archivo de inicialización para **KK**:


```bash
oracle@oracle19c:~$ ls -l /opt/oracle/product/19c/dbhome_1/dbs/
total 20
-rw-rw---- 1 oracle oinstall 1544 nov 17 17:42 hc_ORCLCDB.dat
-rw-r--r-- 1 oracle oinstall 3079 may 14  2015 init.ora
-rw-r----- 1 oracle oinstall   24 nov 16 14:15 lkORCLCDB
-rw-r----- 1 oracle dba      2048 nov 16 14:17 orapwORCLCDB
-rw-r----- 1 oracle oinstall 3584 nov 17 17:42 spfileORCLCDB.ora
oracle@oracle19c:~$ cd /opt/oracle/product/19c/dbhome_1/dbs/
oracle@oracle19c:/opt/oracle/product/19c/dbhome_1/dbs$ echo "SPFILE='/opt/oracle/product/19c/dbhome_1/dbs/spfileORCLCDB.ora'" > initKK.ora
oracle@oracle19c:/opt/oracle/product/19c/dbhome_1/dbs$ ls -l /opt/oracle/product/19c/dbhome_1/dbs/
total 24
-rw-rw---- 1 oracle oinstall 1544 nov 17 17:42 hc_ORCLCDB.dat
-rw-r--r-- 1 oracle dba        64 nov 17 23:38 initKK.ora
-rw-r--r-- 1 oracle oinstall 3079 may 14  2015 init.ora
-rw-r----- 1 oracle oinstall   24 nov 16 14:15 lkORCLCDB
-rw-r----- 1 oracle dba      2048 nov 16 14:17 orapwORCLCDB
-rw-r----- 1 oracle oinstall 3584 nov 17 17:42 spfileORCLCDB.ora
```

### Paso 4: Arrancar la base de datos

Finalmente, pude iniciar la base de datos:

```bash
oracle@oracle19c:/opt/oracle/product/19c/dbhome_1/dbs$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Sun Nov 17 23:39:11 2024
Version 19.3.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.

Connected to an idle instance.

SQL> STARTUP NOMOUNT;
ORACLE instance started.

Total System Global Area 1644164456 bytes
Fixed Size		    9135464 bytes
Variable Size		  956301312 bytes
Database Buffers	  671088640 bytes
Redo Buffers		    7639040 bytes
SQL> ALTER DATABASE MOUNT;

Base de datos modificada.

SQL> ALTER DATABASE OPEN;

Base de datos modificada.
```

La base de datos se abrió correctamente y pude ver que el nombre de la instancia era **KK**:

```sql
SQL> SELECT INSTANCE_NAME FROM V$INSTANCE;

INSTANCE_NAME
----------------
KK
```

Luego tenemos que dejar así el listener y el tnsnames:

```bash
oracle@oracle19c:/opt/oracle/product/19c/dbhome_1/dbs$ cat /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora
# tnsnames.ora Network Configuration File: /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora
# Generated by Oracle configuration tools.

KK =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = oracle19c)(PORT = 1521))
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = ORCLCDB)
    )
  )

LISTENER_ORCLCDB =
  (ADDRESS = (PROTOCOL = TCP)(HOST = oracle19c)(PORT = 1521))
```

```bash
oracle@oracle19c:/opt/oracle/product/19c/dbhome_1/dbs$ cat /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora 
# listener.ora Network Configuration File: /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora
# Generated by Oracle configuration tools.

LISTENER =
  (DESCRIPTION_LIST =
    (DESCRIPTION =
      (ADDRESS = (PROTOCOL = TCP)(HOST = oracle19c)(PORT = 1521))
      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
    )
  )

SID_LIST_LISTENER=
  (SID_LIST=
      (SID_DESC=
         (SID_NAME=PSQLU)
         (ORACLE_HOME=/opt/oracle/product/19c/dbhome_1)
         (PROGRAM=dg4odbc)
      )
  )
```

Reiniciamos con lsnrctl stop y lsnrctl start.

Verificamos que todo vaya bien:
```bash
oracle@oracle19c:/opt/oracle/product/19c/dbhome_1/dbs$ tnsping KK

TNS Ping Utility for Linux: Version 19.0.0.0.0 - Production on 18-NOV-2024 00:37:55

Copyright (c) 1997, 2019, Oracle.  All rights reserved.

Used parameter files:
/opt/oracle/product/19c/dbhome_1/network/admin/sqlnet.ora


Used TNSNAMES adapter to resolve the alias
Attempting to contact (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = oracle19c)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = ORCLCDB)))
OK (0 msec)
```

Y como vemos nos podemos conectar perfectamente:
```bash
oracle@oracle19c:~$ sqlplus pablolink/password@KK

SQL*Plus: Release 19.0.0.0.0 - Production on Mon Nov 18 00:38:39 2024
Version 19.3.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.

Hora de Ultima Conexion Correcta: Dom Nov 17 2024 23:59:24 +01:00

Conectado a:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0

SQL>
```

---

## 3. **Creación de un usuario (RAUL)**

### Paso 1: Crear el usuario **RAUL**

Ejecuté los siguientes comandos para crear el usuario **RAUL** y asiKKarle permisos:

```sql
CREATE USER RAUL IDENTIFIED BY password;
GRANT CONNECT, RESOURCE TO RAUL;
```

### Paso 2: Comprobar la creación del usuario

Verifiqué que el usuario **RAUL** se hubiera creado correctamente:

```sql
SELECT USERNAME FROM DBA_USERS WHERE USERNAME = 'RAUL';
RAUL
```

---

## CLIENTE

### Paso 1: cambiar el tnsnames.ora

Debe quedar así:

```bash
(myenv) pablo@cliente-oracle:~/app_oracle2$ cat /opt/oracle/instantclient_21_15/network/admin/tsnames.ora
KK =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.122.195)(PORT = 1521))
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = KK)
    )
  )
```

### Paso 2: Conexión exitosa desde el cliente

Ahora, pude conectar desde el cliente utilizando:

```bash
sqlplus pablolink/password@//192.168.122.195:1521/ORCLCDB
```

---

Y ahora, desde la aplicación tan solo tenemos que cambiar esto:

```
# Configuración de conexión a Oracle
def get_connection(username, password):
    try:
        # Cambia la dirección IP, puerto y servicio de Oracle por los correctos
        dsn = cx_Oracle.makedsn("192.168.122.195", 1521, service_name="KK")
        connection = cx_Oracle.connect(user=username, password=password, dsn=dsn)
        return connection
    except cx_Oracle.DatabaseError as e:
        print(f"Error en la conexión: {e}")
```


Por si lo necesito. para dar todos los permisos:

```
SQL> GRANT DBA TO RAUL;

Concesion terminada correctamente.

SQL> GRANT ALL PRIVILEGES TO RAUL;

Concesion terminada correctamente.
```

Y para conectarme con el usuario Raul y ver en que instancia y usuario estoy:

```
(myenv) pablo@cliente-oracle:~/app_oracle2$ sqlplus raul/raulpassword@//192.168.122.195:1521/KK

SQL*Plus: Release 21.0.0.0.0 - Production on Mon Nov 18 00:22:49 2024
Version 21.15.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.

Hora de Ultima Conexion Correcta: Lun Nov 18 2024 00:19:46 +01:00

Conectado a:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0

SQL> SELECT INSTANCE_NAME FROM V$INSTANCE;

INSTANCE_NAME
----------------
KK

SQL> SHOW PARAMETER service_names;

NAME				     TYPE	 VALUE
------------------------------------ ----------- ------------------------------
service_names			     string	 KK
```


---

2. Para este ejercicio necesitarás tener en una BD ORACLE llamada GN, en el esquema RAUL la tabla profesores antes creada y en una BD MySQL llamada GN2 en otra máquina la siguiente tabla Asignaturas:

| Nombre | DNI Profesor |
---------------------------
| ASO | 28888888 |
| ABD | 27777777 |

a) Debes realizar una consulta desde un cliente ORACLE que muestre el nombre de las asignaturas y el del profesor que las imparte usando una interconexión entre ambos servidores. (2 puntos)

b) Debes realizar una consulta desde un cliente MySQL que muestre el nombre de las asignaturas y el del profesor que las imparte usando una interconexión entre ambos servidores. (2 puntos)